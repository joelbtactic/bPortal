{% load i18n %}
{% load filters %}
<!DOCTYPE html>
<html>
{% load pwa %}

<head>
    {% load static %}

  {% progressive_web_app_meta %}
  <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" type="text/css" href="{% static 'portal/bootstrap.min.css' %}" />
  <script src="{% static 'portal/jquery-3.6.4.min.js' %}"></script>
    <script src="{% static 'portal/tether.min.js' %}"></script>
    <script src="{% static 'portal/jquery-ui.min.js' %}"></script>
    <script src="{% static 'portal/popper.min.js' %}"></script>
    <script src="{% static 'portal/bootstrap.min.js' %}"></script>
  <script src="{% static 'fontawesomefree/js/all.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'portal/basepage.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'portal/popup-offline.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'portal/jquery-ui.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'portal/iconic/font/css/open-iconic-bootstrap.css' %}" />
  <link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">

    {% block static_files %}{% endblock %}
    <title>{% block title %}bPortal{% endblock %}</title>
  {% block favicon %}
  <link rel="shortcut icon" href="{% static 'portal/img/icons/favicon/favicon.ico' %}">{% endblock %}
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/serviceworker.js')
        .then(function (registration) {
          console.log('Service Worker registered with scope:', registration.scope);
        }).catch(function (error) {
          console.log('Service Worker registration failed:', error);
        });
    }
// Listen for the 'offline' event
    window.addEventListener('offline', function () {
      const popup = document.getElementById('offline-notification');
      popup.classList.toggle("show");


      // Hide the popup after 3 seconds
      setTimeout(() => {
        popup.classList.remove('show'); // Remove show class for fade out
      }, 3000); // Show for 3 seconds      // You can replace the alert with a more sophisticated popup
    });

    // Handle link clicks
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('a').forEach(function (link) {
        link.addEventListener('click', function (event) {
          if (!navigator.onLine) {
            event.preventDefault();  // Prevent the default link behavior
            const popup = document.getElementById('offline-notification');
            popup.classList.toggle("show");


            // Hide the popup after 3 seconds
            setTimeout(() => {
              popup.classList.remove('show'); // Remove show class for fade out
            }, 3000); // Show for 3 seconds
          }
        });
      });
    });
  </script>
</head>

<body>

   <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
     <a class="navbar-brand" href="{% url 'index' %}"><span class="oi oi-home"></span> {% trans "Home" %}</a>
     <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
       <span class="navbar-toggler-icon"></span>
     </button>
     <div class="collapse navbar-collapse" id="navbar">
       <ul class="navbar-nav mr-auto">
         <li class="nav-item dropdown">
           <a class="nav-link dropdown-toggle" id="modules_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="oi oi-spreadsheet"></span> {% trans "Modules" %}</a>
           <div class="dropdown-menu scrollable-dropdown" aria-labelledby="modules_dropdown">
            {% if modules %}
                {% for module_key, module in modules.items %}
                    {% with module_img=module_key|get_module_dark_svg %}
                        <a class="dropdown-item" id="modules_dropdown_{{ module.module_key }}" href="{% url 'module_list' module.module_key %}"><img src="{% static module_img %}" width="25px"> {{ module_labels|get_label:module_key }}</a>
                    {% endwith %}
                {% endfor %}
              {% endif %}
           </div>
         </li>
         {% if request.user.is_superuser %}
           <li class="nav-item dropdown">
             <a class="nav-link dropdown-toggle" id="configure_portal_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="oi oi-wrench"></span> {% trans "Configure portal" %}</a>
             <div class="dropdown-menu scrollable-dropdown" aria-labelledby="modules_dropdown">
               <a class="dropdown-item" id="edit_views" href="{% url 'edit_layouts' %}"><span class="oi oi-list-rich"></span> {% trans "Edit views" %}</a>
               <a class="dropdown-item" id="edit_roles" href="{% url 'edit_roles' %}"><span class="oi oi-shield"></span> {% trans "Edit roles" %}</a>
               <a class="dropdown-item" id="edit_users" href="{% url 'edit_users' %}"><span class="oi oi-people"></span> {% trans "Edit users" %}</a>
               <a class="dropdown-item" id="cache" href="{% url 'cache' %}"><span class="oi oi-hard-drive"></span> {% trans "Cache" %}</a>
               <a class="dropdown-item" id="cache" href="{% url 'pdf_templates' %}"><span class="oi oi-document"></span> {% trans "PDF Templates Settings" %}</a>
             </div>
            </li>
         {% endif %}
       </ul>
       <ul class="my-2 my-lg-0">
         <span class="navbar-text my-2 my-sm-0">{% blocktrans with username=request.user.username %}Signed in as <b>{{username}}</b>{% endblocktrans %}</span>
         <a href="{% url 'user_profile' %}" class="btn btn-outline-primary my-2 my-sm-0 ml-2" role="button"><span class="oi oi-person"></span> {% trans "Profile" %}</a>
         <a href="{% url 'logout' %}" class="btn btn-outline-danger my-2 my-sm-0 ml-2" role="button"><span class="oi oi-account-logout"></span> {% trans "Logout" %}</a>
       </ul>
     </div>
   </nav>


  <div class="popup">
    <span class="popuptext" id="offline-notification">{% trans "You are currently offline. Some features may not be available." %}</span>
  </div>
   <main role="main" class="container">
       {% block content %}{% endblock %}
   </main>

 </body>

</html>
